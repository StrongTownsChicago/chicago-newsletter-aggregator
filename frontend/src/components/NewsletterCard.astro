---
interface Props {
  newsletter: any;
}
const { newsletter } = Astro.props;
const summaryId = `summary-${newsletter.id}`;
---
<article class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200">
  <h2 class="text-2xl font-semibold mb-2">
    <a href={`/newsletter/${newsletter.id}`} class="hover:text-blue-600 transition-colors">
      {newsletter.subject}
    </a>
  </h2>
  
  <div class="flex flex-wrap items-center gap-2 text-sm text-gray-600 mb-3">
    {newsletter.sources?.name && (
      <span class="font-medium text-gray-800">{newsletter.sources.name}</span>
    )}
    {newsletter.sources?.ward_number && (
      <span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-full text-xs font-semibold">
        Ward {newsletter.sources.ward_number}
      </span>
    )}
    <span class="text-gray-400">•</span>
    <time datetime={newsletter.received_date}>
      {new Date(newsletter.received_date).toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      })}
    </time>
    {newsletter.relevance_score !== null && (
    <>
        <span class="text-gray-400">•</span>
        <span 
        class={`px-2 py-0.5 rounded-full text-xs font-semibold ${
            newsletter.relevance_score >= 8 ? 'bg-green-100 text-green-800' :
            newsletter.relevance_score >= 5 ? 'bg-yellow-100 text-yellow-800' :
            'bg-gray-100 text-gray-600'
        }`}
        title="Relevance to Strong Towns Chicago priorities (0=not relevant, 10=highly relevant)"
        >
        Relevance: {newsletter.relevance_score}/10
        </span>
    </>
    )}
  </div>

  {newsletter.summary && (
    <div class="mb-3">
      <p class="text-xs font-semibold text-gray-500 mb-1">SUMMARY</p>
      <div>
        <p id={summaryId} class="text-gray-700 line-clamp-2">
          {newsletter.summary}
        </p>
        <button 
          type="button"
          onclick={`document.getElementById('${summaryId}').classList.toggle('line-clamp-2'); this.textContent = this.textContent === 'Show more' ? 'Show less' : 'Show more'`}
          class="text-sm text-blue-600 hover:text-blue-800 mt-1"
        >
          Show more
        </button>
      </div>
    </div>
  )}

  {newsletter.topics && newsletter.topics.length > 0 && (
    <div class="flex flex-wrap gap-2">
      {newsletter.topics.map((topic: string) => (
        <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">
          {topic}
        </span>
      ))}
    </div>
  )}
</article>